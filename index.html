<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ë³´íƒ ì°¸ì—¬ ì‹œìŠ¤í…œ</title>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 2em; background: #f9f9f9; position: relative; }
    input, button { padding: 0.5em; margin: 0.3em 0; border: 1px solid #ccc; border-radius: 4px; }
    .boss { margin-top: 1em; background: #fff; border: 1px solid #ddd; padding: 1em; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .participants { margin-top: 0.5em; font-size: 0.9em; color: #333; }
    .admin-delete { color: red; cursor: pointer; margin-left: 1em; }
    #authInfo { margin-top: 1em; padding: 1em; background: #e8f0fe; border-radius: 8px; }
    #menu { margin-top: 1.5em; padding: 1em; background: #fff; border: 1px solid #ddd; border-radius: 8px; }
    #adminButton { position: absolute; top: 10px; right: 10px; }
  </style>
</head>
<body>
  <h1>ğŸ”¥ ë³´íƒ ì˜¤í”ˆ ë° ì°¸ì—¬</h1>

  <button id="adminButton" onclick="setAdmin()">ğŸ” ê´€ë¦¬ì ì„¤ì •</button>

  <div id="authInfo">
    <strong>ë¡œê·¸ì¸ ìƒíƒœ:</strong> <span id="authStatus">-</span>
    <button onclick="logout()" style="margin-left: 10px;">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

  <div id="menu">
    <strong>ë©”ë‰´</strong>:
    <ul>
      <li>1. ë³´ìŠ¤ ì°¸ì—¬</li>
      <li>2. ì°¸ì—¬ì ëª©ë¡</li>
      <li id="adminMenu" style="display:none;">3. ê´€ë¦¬ì ë©”ë‰´ (ë³´ìŠ¤ ì˜¤í”ˆ/ì‚­ì œ)</li>
    </ul>
  </div>

  <div>
    <label>ë‹‰ë„¤ì„: <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" /></label>
    <button onclick="saveNickname()">ë‹‰ë„¤ì„ ì €ì¥</button>
  </div>

  <div id="adminSection" style="display:none;">
    <label>ë³´ìŠ¤ ID: <input type="text" id="bossId" placeholder="ì˜ˆ: 20250424_ë³´íƒ_ì¹´ì¸" /></label>
    <button onclick="openBoss()">ë³´ìŠ¤ ì˜¤í”ˆ</button>
  </div>

  <h2>âœ… ì˜¤í”ˆëœ ë³´ìŠ¤</h2>
  <div id="bossList"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAY6Ff6uZ-iZ7soeuXBU0mtTKKZZ8gAPck",
      authDomain: "bossraidtracker.firebaseapp.com",
      databaseURL: "https://bossraidtracker-default-rtdb.firebaseio.com",
      projectId: "bossraidtracker",
      storageBucket: "bossraidtracker.appspot.com",
      messagingSenderId: "975753692062",
      appId: "1:975753692062:web:0991fb5bcbc52a9d3d0c8f",
      measurementId: "G-MC8YY38ZP3"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function saveNickname() {
      const nickname = document.getElementById("nickname").value;
      if (nickname) {
        localStorage.setItem("nickname", nickname);
        alert("ë‹‰ë„¤ì„ ì €ì¥ ì™„ë£Œ!");
      }
    }

    function setAdmin() {
      const email = prompt("ê´€ë¦¬ì ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:");
      if (email) {
        localStorage.setItem("admin", email);
        alert("ê´€ë¦¬ì ì„¤ì • ì™„ë£Œ!");
        checkAdmin();
      }
    }

    function isAdmin() {
      return localStorage.getItem("admin") === "dogfightda@gmail.com";
    }

    function checkAdmin() {
      const adminSection = document.getElementById("adminSection");
      const adminMenu = document.getElementById("adminMenu");
      const isAdminUser = isAdmin();
      adminSection.style.display = isAdminUser ? "block" : "none";
      adminMenu.style.display = isAdminUser ? "list-item" : "none";

      const currentUser = localStorage.getItem("admin") || "-";
      document.getElementById("authStatus").textContent = currentUser;
    }

    function logout() {
      localStorage.removeItem("admin");
      alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
      checkAdmin();
    }

    function openBoss() {
      const bossId = document.getElementById("bossId").value;
      if (!bossId) return alert("ë³´ìŠ¤ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
      db.ref("bosses/" + bossId).set({ open: true });
    }

    function participate(bossId) {
      const nickname = localStorage.getItem("nickname");
      if (!nickname) return alert("ë‹‰ë„¤ì„ì„ ë¨¼ì € ì €ì¥í•´ì£¼ì„¸ìš”!");
      db.ref("bosses/" + bossId + "/participants/" + nickname).set(true);
    }

    function deleteParticipant(bossId, nickname) {
      if (!confirm(`${nickname}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
      db.ref("bosses/" + bossId + "/participants/" + nickname).remove();
    }

    function loadBosses() {
      db.ref("bosses").on("value", (snap) => {
        const data = snap.val();
        const container = document.getElementById("bossList");
        container.innerHTML = "";
        for (const bossId in data) {
          const boss = data[bossId];
          let html = `<div class="boss"><b>${bossId}</b><br>`;
          html += `<button onclick="participate('${bossId}')">ì°¸ì—¬</button>`;
          html += `<div class="participants">`;
          if (boss.participants) {
            html += "<ul>";
            for (const nick in boss.participants) {
              html += `<li>${nick}`;
              if (isAdmin()) {
                html += ` <span class="admin-delete" onclick="deleteParticipant('${bossId}', '${nick}')">[ì‚­ì œ]</span>`;
              }
              html += `</li>`;
            }
            html += "</ul>";
          } else {
            html += "ì°¸ì—¬ì ì—†ìŒ";
          }
          html += `</div></div>`;
          container.innerHTML += html;
        }
      });
    }

    window.onload = function() {
      const savedNickname = localStorage.getItem("nickname");
      if (savedNickname) {
        document.getElementById("nickname").value = savedNickname;
      }
      checkAdmin();
      loadBosses();
    }
  </script>
</body>
</html>
